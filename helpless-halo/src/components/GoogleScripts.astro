<script async is:inline src="https://www.googletagmanager.com/gtag/js?id=GT-MR4MFC6"></script>
<script async is:inline src="https://www.googletagmanager.com/gtag/js?id=GT-5TG3DK3"></script>
<script async is:inline>
  // Google Tag Manager
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-PWK4LSL");

  // Gtag Configuration
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }

  // Default consent configuration
  gtag("consent", "default", {
    "ad_user_data": "denied",
    "ad_personalization": "denied",
    "ad_storage": "denied",
    "analytics_storage": "denied",
    "wait_for_update": 500
  });

  gtag("js", new Date());

  // Function to initialize Google Analytics
  function initializeGoogleAnalytics() {
    gtag("config", "GT-MR4MFC6", { 
      "anonymize_ip": true,
      "currency": "EUR",
      "region": "EU"
    });
  }

  // Check for consent status
  function checkUserConsent() {
    // Hypothetical check for user consent; replace with actual implementation
    return typeof cmpApi !== 'undefined' && cmpApi.getConsentStatus && cmpApi.getConsentStatus();
  }

  document.addEventListener('DOMContentLoaded', function() {
    var userHasConsented = checkUserConsent();
    if (userHasConsented) {
      gtag("consent", "update", {
        "ad_user_data": "granted",
        "ad_personalization": "granted",
        "ad_storage": "granted",
        "analytics_storage": "granted"
      });
      initializeGoogleAnalytics();
    }
  });

  document.addEventListener('consentGiven', function() {
    gtag("consent", "update", {
      "ad_user_data": "granted",
      "ad_personalization": "granted",
      "ad_storage": "granted",
      "analytics_storage": "granted"
    });
    initializeGoogleAnalytics();
  });
</script>
